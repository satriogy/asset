
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Management System - Enterprise</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Custom Styles -->
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        .chart-container { position: relative; height: 300px; }
        
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #555; }
        
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-primary:hover { background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100% ); }
        
        .dark { background: #1a1a1a; color: #ffffff; }
        .dark .bg-white { background: #2d2d2d; }
        .dark .bg-gray-50 { background: #252525; }
        .dark .text-gray-900 { color: #ffffff; }
        .dark .text-gray-600 { color: #a0a0a0; }
        .dark .border-gray-200 { border-color: #404040; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; }
        
        .status-badge { 
            display: inline-flex; 
            align-items: center; 
            gap: 0.25rem; 
            padding: 0.25rem 0.75rem; 
            border-radius: 9999px; 
            font-size: 0.75rem; 
            font-weight: 500; 
        }
        
        .kpi-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 1.5rem; 
            border-radius: 1rem; 
            position: relative; 
            overflow: hidden; 
        }
        
        .kpi-card::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            right: 0; 
            width: 100px; 
            height: 100px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 50%; 
            transform: translate(30px, -30px); 
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #10b981;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 2000;
            display: none;
        }

        .toast.show {
            display: block;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- App Container -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <i data-lucide="package" class="w-8 h-8 text-indigo-600 mr-3"></i>
                        <h1 class="text-xl font-bold text-gray-900">Asset Management System</h1>
                    </div>
                    <nav class="hidden md:flex space-x-8">
                        <button onclick="showPage('dashboard')" class="nav-btn text-indigo-600 px-3 py-2 text-sm font-medium">Dashboard</button>
                        <button onclick="showPage('assets')" class="nav-btn text-gray-700 hover:text-indigo-600 px-3 py-2 text-sm font-medium">Assets</button>
                        <button onclick="showPage('maintenance')" class="nav-btn text-gray-700 hover:text-indigo-600 px-3 py-2 text-sm font-medium">Maintenance</button>
                        <button onclick="showPage('reports')" class="nav-btn text-gray-700 hover:text-indigo-600 px-3 py-2 text-sm font-medium">Reports</button>
                        <button onclick="showPage('users')" class="nav-btn text-gray-700 hover:text-indigo-600 px-3 py-2 text-sm font-medium">Users</button>
                        <button onclick="showPage('settings')" class="nav-btn text-gray-700 hover:text-indigo-600 px-3 py-2 text-sm font-medium">Settings</button>
                    </nav>
                    <div class="flex items-center space-x-4">
                        <button onclick="toggleDarkMode()" class="p-2 rounded-md hover:bg-gray-100">
                            <i data-lucide="moon" class="w-5 h-5 text-gray-600"></i>
                        </button>
                        <div class="relative">
                            <button onclick="toggleNotifications()" class="p-2 rounded-md hover:bg-gray-100">
                                <i data-lucide="bell" class="w-5 h-5 text-gray-600"></i>
                                <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                            </button>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center">
                                <span class="text-white text-sm font-medium">A</span>
                            </div>
                            <span class="text-sm font-medium text-gray-700">Admin User</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">Dashboard</h2>
                    <p class="text-gray-600">Overview of your asset management system</p>
                </div>

                <!-- KPI Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="kpi-card card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white/80 text-sm">Total Assets</p>
                                <p class="text-3xl font-bold mt-1" id="total-assets">0</p>
                                <p class="text-white/70 text-sm mt-2">+12% from last month</p>
                            </div>
                            <i data-lucide="package" class="w-12 h-12 text-white/50"></i>
                        </div>
                    </div>
                    
                    <div class="kpi-card card-hover" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white/80 text-sm">Active Assets</p>
                                <p class="text-3xl font-bold mt-1" id="active-assets">0</p>
                                <p class="text-white/70 text-sm mt-2" id="utilization-rate">0% utilization</p>
                            </div>
                            <i data-lucide="activity" class="w-12 h-12 text-white/50"></i>
                        </div>
                    </div>
                    
                    <div class="kpi-card card-hover" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white/80 text-sm">Maintenance</p>
                                <p class="text-3xl font-bold mt-1" id="maintenance-count">0</p>
                                <p class="text-white/70 text-sm mt-2">Scheduled this month</p>
                            </div>
                            <i data-lucide="wrench" class="w-12 h-12 text-white/50"></i>
                        </div>
                    </div>
                    
                    <div class="kpi-card card-hover" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white/80 text-sm">Health Score</p>
                                <p class="text-3xl font-bold mt-1">94%</p>
                                <p class="text-white/70 text-sm mt-2">Excellent condition</p>
                            </div>
                            <i data-lucide="trending-up" class="w-12 h-12 text-white/50"></i>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 class="text-lg font-semibold mb-4">Asset Distribution</h3>
                        <div class="chart-container">
                            <canvas id="assetChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 class="text-lg font-semibold mb-4">Maintenance Overview</h3>
                        <div class="chart-container">
                            <canvas id="maintenanceChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">Recent Activity</h3>
                    </div>
                    <div class="p-6 space-y-4 max-h-96 overflow-y-auto scrollbar-thin" id="recent-activity">
                        <!-- Activity items will be dynamically added here -->
                    </div>
                </div>
            </div>

            <!-- Assets Page -->
            <div id="assets-page" class="page hidden">
                <div class="mb-8 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Asset Management</h2>
                        <p class="text-gray-600">Manage and track all company assets</p>
                    </div>
                    <button onclick="openAddAssetModal()" class="btn-primary text-white px-4 py-2 rounded-lg hover:opacity-90 transition-opacity flex items-center space-x-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        <span>Add Asset</span>
                    </button>
                </div>

                <!-- Filters -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6">
                    <div class="flex flex-wrap gap-4 items-center">
                        <div class="flex-1 min-w-64">
                            <div class="relative">
                                <i data-lucide="search" class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="asset-search" placeholder="Search assets..." onkeyup="filterAssets()" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>
                        </div>
                        <select id="category-filter" onchange="filterAssets()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="">All Categories</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Furniture">Furniture</option>
                            <option value="Vehicle">Vehicle</option>
                            <option value="Equipment">Equipment</option>
                        </select>
                        <select id="status-filter" onchange="filterAssets()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="">All Status</option>
                            <option value="Active">Active</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Retired">Retired</option>
                        </select>
                        <button onclick="exportAssets()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center space-x-2">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>Export</span>
                        </button>
                    </div>
                </div>

                <!-- Assets Table -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asset</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Purchase Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="assets-table-body">
                                <!-- Asset rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Maintenance Page -->
            <div id="maintenance-page" class="page hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">Maintenance Management</h2>
                    <p class="text-gray-600">Schedule and track asset maintenance</p>
                </div>

                <!-- View Toggle -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6">
                    <div class="flex justify-between items-center">
                        <div class="flex space-x-2">
                            <button onclick="setMaintenanceView('calendar')" class="maintenance-view-btn px-4 py-2 bg-indigo-600 text-white rounded-lg">Calendar</button>
                            <button onclick="setMaintenanceView('list')" class="maintenance-view-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">List View</button>
                        </div>
                        <button onclick="openScheduleMaintenanceModal()" class="btn-primary text-white px-4 py-2 rounded-lg hover:opacity-90 transition-opacity flex items-center space-x-2">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            <span>Schedule Maintenance</span>
                        </button>
                    </div>
                </div>

                <!-- Calendar View -->
                <div id="maintenance-calendar" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold">February 2024</h3>
                        <div class="flex space-x-2">
                            <button onclick="changeMonth(-1)" class="p-2 hover:bg-gray-100 rounded-lg">
                                <i data-lucide="chevron-left" class="w-5 h-5"></i>
                            </button>
                            <button onclick="changeMonth(1)" class="p-2 hover:bg-gray-100 rounded-lg">
                                <i data-lucide="chevron-right" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="calendar-grid text-center" id="calendar-grid">
                        <!-- Calendar will be generated by JavaScript -->
                    </div>
                </div>

                <!-- List View (Hidden by default) -->
                <div id="maintenance-list" class="hidden">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="divide-y divide-gray-200" id="maintenance-list-items">
                            <!-- Maintenance items will be dynamically added here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports-page" class="page hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">Reports & Analytics</h2>
                    <p class="text-gray-600">Generate insights and export data</p>
                </div>

                <!-- Report Types -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 card-hover cursor-pointer">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                            <i data-lucide="file-text" class="w-6 h-6 text-blue-600"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Asset Inventory Report</h3>
                        <p class="text-gray-600 text-sm mb-4">Complete list of all assets with details</p>
                        <button onclick="generateReport('inventory')" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm">Generate Report →</button>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 card-hover cursor-pointer">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                            <i data-lucide="trending-up" class="w-6 h-6 text-green-600"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Depreciation Report</h3>
                        <p class="text-gray-600 text-sm mb-4">Asset value depreciation over time</p>
                        <button onclick="generateReport('depreciation')" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm">Generate Report →</button>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 card-hover cursor-pointer">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4">
                            <i data-lucide="wrench" class="w-6 h-6 text-purple-600"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Maintenance Report</h3>
                        <p class="text-gray-600 text-sm mb-4">Maintenance history and schedules</p>
                        <button onclick="generateReport('maintenance')" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm">Generate Report →</button>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 class="text-lg font-semibold mb-4">Asset Value by Category</h3>
                        <div class="chart-container">
                            <canvas id="valueChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 class="text-lg font-semibold mb-4">Monthly Maintenance Costs</h3>
                        <div class="chart-container">
                            <canvas id="costChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="users-page" class="page hidden">
                <div class="mb-8 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">User Management</h2>
                        <p class="text-gray-600">Manage user access and permissions</p>
                    </div>
                    <button onclick="openAddUserModal()" class="btn-primary text-white px-4 py-2 rounded-lg hover:opacity-90 transition-opacity flex items-center space-x-2">
                        <i data-lucide="user-plus" class="w-4 h-4"></i>
                        <span>Add User</span>
                    </button>
                </div>

                <!-- Users Table -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Active</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="users-table-body">
                                <!-- User rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page" class="page hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">Settings</h2>
                    <p class="text-gray-600">Configure system preferences and settings</p>
                </div>

                <!-- Settings Tabs -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6">
                            <button onclick="setSettingsTab('general')" class="settings-tab py-4 border-b-2 border-indigo-500 text-indigo-600 font-medium">General</button>
                            <button onclick="setSettingsTab('notifications')" class="settings-tab py-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700">Notifications</button>
                            <button onclick="setSettingsTab('security')" class="settings-tab py-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700">Security</button>
                            <button onclick="setSettingsTab('backup')" class="settings-tab py-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700">Backup</button>
                            <button onclick="setSettingsTab('api')" class="settings-tab py-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700">API</button>
                        </nav>
                    </div>

                    <!-- General Settings -->
                    <div id="general-settings" class="settings-content p-6">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
                                <input type="text" id="company-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Default Currency</label>
                                <select id="default-currency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <option value="IDR">Indonesian Rupiah (IDR)</option>
                                    <option value="USD">US Dollar (USD)</option>
                                    <option value="EUR">Euro (EUR)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Date Format</label>
                                <select id="date-format" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                </select>
                            </div>
                            <button onclick="saveSettings()" class="btn-primary text-white px-4 py-2 rounded-lg">Save Settings</button>
                        </div>
                    </div>

                    <!-- Other settings tabs (hidden by default) -->
                    <div id="notifications-settings" class="settings-content p-6 hidden">
                        <h3 class="text-lg font-medium mb-4">Notification Preferences</h3>
                        <div class="space-y-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="notify-maintenance" checked class="mr-3">
                                <span>Email notifications for maintenance due</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notify-warranty" checked class="mr-3">
                                <span>Email notifications for warranty expiry</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notify-sms" class="mr-3">
                                <span>SMS notifications for urgent issues</span>
                            </label>
                        </div>
                        <button onclick="saveSettings()" class="btn-primary text-white px-4 py-2 rounded-lg mt-4">Save Settings</button>
                    </div>

                    <div id="security-settings" class="settings-content p-6 hidden">
                        <h3 class="text-lg font-medium mb-4">Security Settings</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Session Timeout (minutes)</label>
                                <input type="number" id="session-timeout" value="30" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" id="require-2fa" checked class="mr-3">
                                    <span>Require two-factor authentication</span>
                                </label>
                            </div>
                        </div>
                        <button onclick="saveSettings()" class="btn-primary text-white px-4 py-2 rounded-lg mt-4">Save Settings</button>
                    </div>

                    <div id="backup-settings" class="settings-content p-6 hidden">
                        <h3 class="text-lg font-medium mb-4">Backup Configuration</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Backup Frequency</label>
                                <select id="backup-frequency" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <button onclick="backupData()" class="btn-primary text-white px-4 py-2 rounded-lg">Backup Now</button>
                            <button onclick="restoreData()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Restore Data</button>
                        </div>
                    </div>

                    <div id="api-settings" class="settings-content p-6 hidden">
                        <h3 class="text-lg font-medium mb-4">API Configuration</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                                <div class="flex">
                                    <input type="password" id="api-key" value="sk-1234567890abcdef" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-lg">
                                    <button onclick="toggleApiKeyVisibility()" class="px-4 py-2 bg-gray-200 border border-l-0 border-gray-300 rounded-r-lg hover:bg-gray-300">Show</button>
                                </div>
                            </div>
                            <button onclick="generateApiKey()" class="btn-primary text-white px-4 py-2 rounded-lg">Generate New Key</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 mt-auto">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex justify-between items-center">
                    <p class="text-gray-500 text-sm">© 2024 Asset Management System. All rights reserved.</p>
                    <div class="flex space-x-6">
                        <a href="#" class="text-gray-500 hover:text-gray-700 text-sm">Help</a>
                        <a href="#" class="text-gray-500 hover:text-gray-700 text-sm">Privacy</a>
                        <a href="#" class="text-gray-500 hover:text-gray-700 text-sm">Terms</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Add Asset Modal -->
    <div id="add-asset-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">Add New Asset</h3>
                <button onclick="closeModal('add-asset-modal')" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <form id="add-asset-form" onsubmit="saveAsset(event)">
                <div class="form-group">
                    <label for="asset-name">Asset Name *</label>
                    <input type="text" id="asset-name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="form-group">
                    <label for="asset-category">Category *</label>
                    <select id="asset-category" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">Select Category</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Furniture">Furniture</option>
                        <option value="Vehicle">Vehicle</option>
                        <option value="Equipment">Equipment</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="asset-status">Status *</label>
                    <select id="asset-status" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="Active">Active</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Retired">Retired</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="asset-location">Location *</label>
                    <input type="text" id="asset-location" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="form-group">
                    <label for="asset-value">Value (IDR) *</label>
                    <input type="number" id="asset-value" required min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="form-group">
                    <label for="asset-purchase-date">Purchase Date *</label>
                    <input type="date" id="asset-purchase-date" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="form-group">
                    <label for="asset-description">Description</label>
                    <textarea id="asset-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea>
                </div>
                
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary text-white px-4 py-2 rounded-lg flex-1">Save Asset</button>
                    <button type="button" onclick="closeModal('add-asset-modal')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex-1">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="add-user-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">Add New User</h3>
                <button onclick="closeModal('add-user-modal')" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <form id="add-user-form" onsubmit="saveUser(event)">
                <div class="form-group">
                    <label for="user-name">Full Name *</label>
                    <input type="text" id="user-name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="form-group">
                    <label for="user-email">Email *</label>
                    <input type="email" id="user-email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="form-group">
                    <label for="user-role">Role *</label>
                    <select id="user-role" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">Select Role</option>
                        <option value="Administrator">Administrator</option>
                        <option value="Manager">Manager</option>
                        <option value="Staff">Staff</option>
                        <option value="Viewer">Viewer</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="user-department">Department *</label>
                    <input type="text" id="user-department" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary text-white px-4 py-2 rounded-lg flex-1">Save User</button>
                    <button type="button" onclick="closeModal('add-user-modal')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex-1">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Schedule Maintenance Modal -->
    <div id="schedule-maintenance-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">Schedule Maintenance</h3>
                <button onclick="closeModal('schedule-maintenance-modal')" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <form id="schedule-maintenance-form" onsubmit="saveMaintenance(event)">
                <div class="form-group">
                    <label for="maintenance-title">Title *</label>
                    <input type="text" id="maintenance-title" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="form-group">
                    <label for="maintenance-asset">Asset *</label>
                    <select id="maintenance-asset" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">Select Asset</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="maintenance-date">Date *</label>
                    <input type="date" id="maintenance-date" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="form-group">
                    <label for="maintenance-time">Time *</label>
                    <input type="time" id="maintenance-time" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="form-group">
                    <label for="maintenance-type">Type *</label>
                    <select id="maintenance-type" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">Select Type</option>
                        <option value="Preventive">Preventive</option>
                        <option value="Corrective">Corrective</option>
                        <option value="Emergency">Emergency</option>
                        <option value="Inspection">Inspection</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="maintenance-description">Description</label>
                    <textarea id="maintenance-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea>
                </div>
                
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary text-white px-4 py-2 rounded-lg flex-1">Schedule Maintenance</button>
                    <button type="button" onclick="closeModal('schedule-maintenance-modal')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex-1">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span id="toast-message"></span>
    </div>

    <!-- Notification Panel -->
    <div id="notification-panel" class="fixed top-16 right-4 w-80 bg-white rounded-lg shadow-lg border border-gray-200 hidden z-50">
        <div class="p-4 border-b border-gray-200">
            <h3 class="font-semibold">Notifications</h3>
        </div>
        <div class="max-h-96 overflow-y-auto" id="notification-list">
            <!-- Notifications will be dynamically added here -->
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Database Manager
        class DatabaseManager {
            constructor() {
                this.initializeDatabase();
            }

            initializeDatabase() {
                if (!localStorage.getItem('assets')) {
                    localStorage.setItem('assets', JSON.stringify(this.getSampleAssets()));
                }
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify(this.getSampleUsers()));
                }
                if (!localStorage.getItem('maintenance')) {
                    localStorage.setItem('maintenance', JSON.stringify(this.getSampleMaintenance()));
                }
                if (!localStorage.getItem('activities')) {
                    localStorage.setItem('activities', JSON.stringify([]));
                }
                if (!localStorage.getItem('settings')) {
                    localStorage.setItem('settings', JSON.stringify(this.getSampleSettings()));
                }
            }

            getSampleAssets() {
                return [
                    {
                        id: 'AST001',
                        name: 'Laptop Dell XPS 15',
                        category: 'Electronics',
                        status: 'Active',
                        location: 'Office A',
                        value: 24990000,
                        purchaseDate: '2024-01-15',
                        description: 'High-performance laptop for development team'
                    },
                    {
                        id: 'AST002',
                        name: 'Company Vehicle - Toyota Avanza',
                        category: 'Vehicle',
                        status: 'Active',
                        location: 'Parking Lot',
                        value: 250000000,
                        purchaseDate: '2023-06-20',
                        description: 'Company vehicle for operations'
                    },
                    {
                        id: 'AST003',
                        name: 'Office Desk Ergonomic',
                        category: 'Furniture',
                        status: 'Active',
                        location: 'Office B',
                        value: 3500000,
                        purchaseDate: '2023-12-10',
                        description: 'Ergonomic office desk'
                    }
                ];
            }

            getSampleUsers() {
                return [
                    {
                        id: 'USR001',
                        name: 'Admin User',
                        email: 'admin@company.com',
                        role: 'Administrator',
                        department: 'IT',
                        status: 'Active',
                        lastActive: new Date().toISOString()
                    },
                    {
                        id: 'USR002',
                        name: 'John Manager',
                        email: 'john@company.com',
                        role: 'Manager',
                        department: 'Operations',
                        status: 'Active',
                        lastActive: new Date(Date.now() - 3600000).toISOString()
                    }
                ];
            }

            getSampleMaintenance() {
                return [
                    {
                        id: 'MNT001',
                        title: 'Server Room HVAC Maintenance',
                        assetId: 'AST001',
                        assetName: 'Laptop Dell XPS 15',
                        date: '2024-02-15',
                        time: '14:00',
                        type: 'Preventive',
                        status: 'Scheduled',
                        description: 'Quarterly inspection and cleaning'
                    }
                ];
            }

            getSampleSettings() {
                return {
                    companyName: 'PT. Asset Management Indonesia',
                    defaultCurrency: 'IDR',
                    dateFormat: 'DD/MM/YYYY',
                    notifyMaintenance: true,
                    notifyWarranty: true,
                    notifySms: false,
                    sessionTimeout: 30,
                    require2FA: true,
                    backupFrequency: 'weekly'
                };
            }

            // Assets
            getAssets() {
                return JSON.parse(localStorage.getItem('assets') || '[]');
            }

            saveAsset(asset) {
                const assets = this.getAssets();
                asset.id = asset.id || 'AST' + Date.now().toString().slice(-6);
                asset.createdAt = asset.createdAt || new Date().toISOString();
                
                const existingIndex = assets.findIndex(a => a.id === asset.id);
                if (existingIndex >= 0) {
                    assets[existingIndex] = { ...assets[existingIndex], ...asset, updatedAt: new Date().toISOString() };
                } else {
                    assets.push(asset);
                }
                
                localStorage.setItem('assets', JSON.stringify(assets));
                this.addActivity(`Asset ${asset.name} ${existingIndex >= 0 ? 'updated' : 'added'}`, 'asset');
                return asset;
            }

            deleteAsset(assetId) {
                const assets = this.getAssets();
                const asset = assets.find(a => a.id === assetId);
                const filtered = assets.filter(a => a.id !== assetId);
                localStorage.setItem('assets', JSON.stringify(filtered));
                this.addActivity(`Asset ${asset.name} deleted`, 'asset');
            }

            // Users
            getUsers() {
                return JSON.parse(localStorage.getItem('users') || '[]');
            }

            saveUser(user) {
                const users = this.getUsers();
                user.id = user.id || 'USR' + Date.now().toString().slice(-6);
                user.createdAt = user.createdAt || new Date().toISOString();
                
                const existingIndex = users.findIndex(u => u.id === user.id);
                if (existingIndex >= 0) {
                    users[existingIndex] = { ...users[existingIndex], ...user, updatedAt: new Date().toISOString() };
                } else {
                    users.push(user);
                }
                
                localStorage.setItem('users', JSON.stringify(users));
                this.addActivity(`User ${user.name} ${existingIndex >= 0 ? 'updated' : 'added'}`, 'user');
                return user;
            }

            deleteUser(userId) {
                const users = this.getUsers();
                const user = users.find(u => u.id === userId);
                const filtered = users.filter(u => u.id !== userId);
                localStorage.setItem('users', JSON.stringify(filtered));
                this.addActivity(`User ${user.name} deleted`, 'user');
            }

            // Maintenance
            getMaintenance() {
                return JSON.parse(localStorage.getItem('maintenance') || '[]');
            }

            saveMaintenance(maintenance) {
                const maintenanceList = this.getMaintenance();
                maintenance.id = maintenance.id || 'MNT' + Date.now().toString().slice(-6);
                maintenance.createdAt = maintenance.createdAt || new Date().toISOString();
                
                const existingIndex = maintenanceList.findIndex(m => m.id === maintenance.id);
                if (existingIndex >= 0) {
                    maintenanceList[existingIndex] = { ...maintenanceList[existingIndex], ...maintenance, updatedAt: new Date().toISOString() };
                } else {
                    maintenanceList.push(maintenance);
                }
                
                localStorage.setItem('maintenance', JSON.stringify(maintenanceList));
                this.addActivity(`Maintenance "${maintenance.title}" ${existingIndex >= 0 ? 'updated' : 'scheduled'}`, 'maintenance');
                return maintenance;
            }

            // Activities
            getActivities() {
                return JSON.parse(localStorage.getItem('activities') || '[]');
            }

            addActivity(description, type) {
                const activities = this.getActivities();
                activities.unshift({
                    id: Date.now().toString(),
                    description,
                    type,
                    timestamp: new Date().toISOString()
                });
                
                // Keep only last 50 activities
                if (activities.length > 50) {
                    activities.splice(50);
                }
                
                localStorage.setItem('activities', JSON.stringify(activities));
            }

            // Settings
            getSettings() {
                return JSON.parse(localStorage.getItem('settings') || '{}');
            }

            saveSettings(settings) {
                localStorage.setItem('settings', JSON.stringify(settings));
                this.addActivity('Settings updated', 'system');
            }

            // Export/Import
            exportData() {
                return {
                    assets: this.getAssets(),
                    users: this.getUsers(),
                    maintenance: this.getMaintenance(),
                    activities: this.getActivities(),
                    settings: this.getSettings(),
                    exportDate: new Date().toISOString()
                };
            }

            importData(data) {
                if (data.assets) localStorage.setItem('assets', JSON.stringify(data.assets));
                if (data.users) localStorage.setItem('users', JSON.stringify(data.users));
                if (data.maintenance) localStorage.setItem('maintenance', JSON.stringify(data.maintenance));
                if (data.activities) localStorage.setItem('activities', JSON.stringify(data.activities));
                if (data.settings) localStorage.setItem('settings', JSON.stringify(data.settings));
                
                this.addActivity('Data imported from backup', 'system');
            }
        }

        // Initialize database
        const db = new DatabaseManager();

        // Global state
        let currentPage = 'dashboard';
        let isDarkMode = false;
        let maintenanceView = 'calendar';
        let currentSettingsTab = 'general';
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // Page navigation
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show selected page
            document.getElementById(pageName + '-page').classList.remove('hidden');
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-indigo-600');
                btn.classList.add('text-gray-700');
            });
            
            event.target.classList.remove('text-gray-700');
            event.target.classList.add('text-indigo-600');
            
            currentPage = pageName;
            
            // Initialize page-specific content
            if (pageName === 'dashboard') {
                updateDashboard();
                initDashboardCharts();
            } else if (pageName === 'assets') {
                loadAssets();
            } else if (pageName === 'maintenance' && maintenanceView === 'calendar') {
                generateCalendar();
            } else if (pageName === 'maintenance' && maintenanceView === 'list') {
                loadMaintenanceList();
            } else if (pageName === 'reports') {
                initReportsCharts();
            } else if (pageName === 'users') {
                loadUsers();
            } else if (pageName === 'settings') {
                loadSettings();
            }
            
            // Re-initialize icons
            setTimeout(() => lucide.createIcons(), 100);
        }

        // Update Dashboard
        function updateDashboard() {
            const assets = db.getAssets();
            const maintenance = db.getMaintenance();
            const activities = db.getActivities();
            
            // Update KPIs
            document.getElementById('total-assets').textContent = assets.length;
            document.getElementById('active-assets').textContent = assets.filter(a => a.status === 'Active').length;
            
            const utilizationRate = assets.length > 0 ? 
                Math.round((assets.filter(a => a.status === 'Active').length / assets.length) * 100) : 0;
            document.getElementById('utilization-rate').textContent = utilizationRate + '% utilization';
            
            document.getElementById('maintenance-count').textContent = maintenance.filter(m => m.status === 'Scheduled').length;
            
            // Update recent activity
            const activityContainer = document.getElementById('recent-activity');
            activityContainer.innerHTML = '';
            
            activities.slice(0, 10).forEach(activity => {
                const activityEl = document.createElement('div');
                activityEl.className = 'flex items-center space-x-4 p-3 hover:bg-gray-50 rounded-lg';
                
                const iconClass = getActivityIcon(activity.type);
                const iconColor = getActivityColor(activity.type);
                const timeAgo = getTimeAgo(new Date(activity.timestamp));
                
                activityEl.innerHTML = `
                    <div class="w-10 h-10 ${iconColor} rounded-full flex items-center justify-center">
                        <i data-lucide="${iconClass}" class="w-5 h-5 text-white"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium">${activity.description}</p>
                        <p class="text-xs text-gray-500">${timeAgo}</p>
                    </div>
                `;
                
                activityContainer.appendChild(activityEl);
            });
            
            lucide.createIcons();
        }

        function getActivityIcon(type) {
            const icons = {
                'asset': 'package',
                'user': 'user',
                'maintenance': 'wrench',
                'system': 'settings'
            };
            return icons[type] || 'activity';
        }

        function getActivityColor(type) {
            const colors = {
                'asset': 'bg-green-100',
                'user': 'bg-blue-100',
                'maintenance': 'bg-yellow-100',
                'system': 'bg-purple-100'
            };
            return colors[type] || 'bg-gray-100';
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' minutes ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
            return Math.floor(seconds / 86400) + ' days ago';
        }

        // Load Assets
        function loadAssets() {
            const assets = db.getAssets();
            const tbody = document.getElementById('assets-table-body');
            tbody.innerHTML = '';
            
            assets.forEach(asset => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const statusClass = getStatusClass(asset.status);
                const iconClass = getCategoryIcon(asset.category);
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="${iconClass}" class="w-5 h-5 text-indigo-600"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${asset.name}</div>
                                <div class="text-sm text-gray-500">Asset #${asset.id}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${asset.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge ${statusClass}">${asset.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${asset.location}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Rp ${asset.value.toLocaleString('id-ID')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(asset.purchaseDate)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="viewAsset('${asset.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">View</button>
                        <button onclick="editAsset('${asset.id}')" class="text-gray-600 hover:text-gray-900 mr-3">Edit</button>
                        <button onclick="deleteAsset('${asset.id}')" class="text-red-600 hover:text-red-900">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            lucide.createIcons();
        }

        function getStatusClass(status) {
            const classes = {
                'Active': 'bg-green-100 text-green-800',
                'Maintenance': 'bg-yellow-100 text-yellow-800',
                'Retired': 'bg-red-100 text-red-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }

        function getCategoryIcon(category) {
            const icons = {
                'Electronics': 'laptop',
                'Furniture': 'home',
                'Vehicle': 'car',
                'Equipment': 'tool'
            };
            return icons[category] || 'package';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID');
        }

        // Filter Assets
        function filterAssets() {
            const searchTerm = document.getElementById('asset-search').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            
            const assets = db.getAssets();
            const filtered = assets.filter(asset => {
                const matchesSearch = asset.name.toLowerCase().includes(searchTerm) || 
                                     asset.id.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || asset.category === categoryFilter;
                const matchesStatus = !statusFilter || asset.status === statusFilter;
                
                return matchesSearch && matchesCategory && matchesStatus;
            });
            
            // Update table with filtered results
            const tbody = document.getElementById('assets-table-body');
            tbody.innerHTML = '';
            
            filtered.forEach(asset => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const statusClass = getStatusClass(asset.status);
                const iconClass = getCategoryIcon(asset.category);
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="${iconClass}" class="w-5 h-5 text-indigo-600"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${asset.name}</div>
                                <div class="text-sm text-gray-500">Asset #${asset.id}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${asset.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge ${statusClass}">${asset.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${asset.location}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Rp ${asset.value.toLocaleString('id-ID')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(asset.purchaseDate)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="viewAsset('${asset.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">View</button>
                        <button onclick="editAsset('${asset.id}')" class="text-gray-600 hover:text-gray-900 mr-3">Edit</button>
                        <button onclick="deleteAsset('${asset.id}')" class="text-red-600 hover:text-red-900">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            lucide.createIcons();
        }

        // Export Assets
        function exportAssets() {
            const assets = db.getAssets();
            const csv = convertToCSV(assets);
            downloadCSV(csv, 'assets.csv');
            showToast('Assets exported successfully');
        }

        function convertToCSV(data) {
            const headers = ['ID', 'Name', 'Category', 'Status', 'Location', 'Value', 'Purchase Date', 'Description'];
            const csvContent = [
                headers.join(','),
                ...data.map(asset => [
                    asset.id,
                    `"${asset.name}"`,
                    asset.category,
                    asset.status,
                    `"${asset.location}"`,
                    asset.value,
                    asset.purchaseDate,
                    `"${asset.description || ''}"`
                ].join(','))
            ].join('\n');
            
            return csvContent;
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Asset Modal Functions
        function openAddAssetModal() {
            document.getElementById('add-asset-modal').classList.add('show');
            // Set today's date as default
            document.getElementById('asset-purchase-date').valueAsDate = new Date();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            // Reset form
            const form = document.querySelector(`#${modalId} form`);
            if (form) form.reset();
        }

        function saveAsset(event) {
            event.preventDefault();
            
            const asset = {
                name: document.getElementById('asset-name').value,
                category: document.getElementById('asset-category').value,
                status: document.getElementById('asset-status').value,
                location: document.getElementById('asset-location').value,
                value: parseInt(document.getElementById('asset-value').value),
                purchaseDate: document.getElementById('asset-purchase-date').value,
                description: document.getElementById('asset-description').value
            };
            
            db.saveAsset(asset);
            closeModal('add-asset-modal');
            loadAssets();
            showToast('Asset saved successfully');
        }

        function viewAsset(assetId) {
            const asset = db.getAssets().find(a => a.id === assetId);
            if (asset) {
                alert(`Asset Details:\n\nName: ${asset.name}\nCategory: ${asset.category}\nStatus: ${asset.status}\nLocation: ${asset.location}\nValue: Rp ${asset.value.toLocaleString('id-ID')}\nPurchase Date: ${formatDate(asset.purchaseDate)}\nDescription: ${asset.description || 'N/A'}`);
            }
        }

        function editAsset(assetId) {
            const asset = db.getAssets().find(a => a.id === assetId);
            if (asset) {
                // Fill form with asset data
                document.getElementById('asset-name').value = asset.name;
                document.getElementById('asset-category').value = asset.category;
                document.getElementById('asset-status').value = asset.status;
                document.getElementById('asset-location').value = asset.location;
                document.getElementById('asset-value').value = asset.value;
                document.getElementById('asset-purchase-date').value = asset.purchaseDate;
                document.getElementById('asset-description').value = asset.description || '';
                
                // Add hidden field for asset ID
                const form = document.getElementById('add-asset-form');
                const existingIdField = form.querySelector('input[name="asset-id"]');
                if (existingIdField) {
                    existingIdField.value = asset.id;
                } else {
                    const idField = document.createElement('input');
                    idField.type = 'hidden';
                    idField.name = 'asset-id';
                    idField.value = asset.id;
                    form.appendChild(idField);
                }
                
                openAddAssetModal();
            }
        }

        function deleteAsset(assetId) {
            if (confirm('Are you sure you want to delete this asset?')) {
                db.deleteAsset(assetId);
                loadAssets();
                showToast('Asset deleted successfully');
            }
        }

        // Load Users
        function loadUsers() {
            const users = db.getUsers();
            const tbody = document.getElementById('users-table-body');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const roleClass = getRoleClass(user.role);
                const initials = user.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white font-medium">${initials}</span>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${user.name}</div>
                                <div class="text-sm text-gray-500">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge ${roleClass}">${user.role}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.department}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge ${user.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${user.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${getTimeAgo(new Date(user.lastActive))}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editUser('${user.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>
                        <button onclick="deleteUser('${user.id}')" class="text-red-600 hover:text-red-900">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function getRoleClass(role) {
            const classes = {
                'Administrator': 'bg-purple-100 text-purple-800',
                'Manager': 'bg-blue-100 text-blue-800',
                'Staff': 'bg-green-100 text-green-800',
                'Viewer': 'bg-gray-100 text-gray-800'
            };
            return classes[role] || 'bg-gray-100 text-gray-800';
        }

        // User Modal Functions
        function openAddUserModal() {
            document.getElementById('add-user-modal').classList.add('show');
        }

        function saveUser(event) {
            event.preventDefault();
            
            const user = {
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                role: document.getElementById('user-role').value,
                department: document.getElementById('user-department').value,
                status: 'Active',
                lastActive: new Date().toISOString()
            };
            
            db.saveUser(user);
            closeModal('add-user-modal');
            loadUsers();
            showToast('User saved successfully');
        }

        function editUser(userId) {
            const user = db.getUsers().find(u => u.id === userId);
            if (user) {
                document.getElementById('user-name').value = user.name;
                document.getElementById('user-email').value = user.email;
                document.getElementById('user-role').value = user.role;
                document.getElementById('user-department').value = user.department;
                
                // Add hidden field for user ID
                const form = document.getElementById('add-user-form');
                const existingIdField = form.querySelector('input[name="user-id"]');
                if (existingIdField) {
                    existingIdField.value = user.id;
                } else {
                    const idField = document.createElement('input');
                    idField.type = 'hidden';
                    idField.name = 'user-id';
                    idField.value = user.id;
                    form.appendChild(idField);
                }
                
                openAddUserModal();
            }
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                db.deleteUser(userId);
                loadUsers();
                showToast('User deleted successfully');
            }
        }

        // Maintenance Functions
        function setMaintenanceView(view) {
            maintenanceView = view;
            
            // Update buttons
            document.querySelectorAll('.maintenance-view-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-indigo-600', 'text-white');
            
            // Toggle views
            if (view === 'calendar') {
                document.getElementById('maintenance-calendar').classList.remove('hidden');
                document.getElementById('maintenance-list').classList.add('hidden');
                generateCalendar();
            } else {
                document.getElementById('maintenance-calendar').classList.add('hidden');
                document.getElementById('maintenance-list').classList.remove('hidden');
                loadMaintenanceList();
            }
        }

        function generateCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            const maintenance = db.getMaintenance();
            
            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Clear calendar
            calendarGrid.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'font-medium text-gray-500 py-2';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'py-2';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'py-2 hover:bg-gray-50 rounded cursor-pointer relative';
                dayElement.innerHTML = `<span class="text-sm">${day}</span>`;
                
                // Check if there's maintenance on this day
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayMaintenance = maintenance.filter(m => m.date === dateStr);
                
                if (dayMaintenance.length > 0) {
                    dayElement.innerHTML += `<div class="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-1 h-1 bg-blue-500 rounded-full"></div>`;
                    dayElement.title = dayMaintenance.map(m => m.title).join(', ');
                }
                
                calendarGrid.appendChild(dayElement);
            }
            
            // Update month/year display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.querySelector('#maintenance-calendar h3').textContent = `${monthNames[currentMonth]} ${currentYear}`;
        }

        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar();
        }

        function loadMaintenanceList() {
            const maintenance = db.getMaintenance();
            const listContainer = document.getElementById('maintenance-list-items');
            listContainer.innerHTML = '';
            
            maintenance.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'p-6 hover:bg-gray-50';
                
                const statusClass = item.status === 'Completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
                
                itemEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="text-lg font-medium text-gray-900">${item.title}</h4>
                            <p class="text-gray-600 mt-1">${item.description || 'No description'}</p>
                            <div class="flex items-center space-x-4 mt-3 text-sm text-gray-500">
                                <span class="flex items-center">
                                    <i data-lucide="calendar" class="w-4 h-4 mr-1"></i>
                                    ${formatDate(item.date)}
                                </span>
                                <span class="flex items-center">
                                    <i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                                    ${item.time}
                                </span>
                                <span class="flex items-center">
                                    <i data-lucide="tag" class="w-4 h-4 mr-1"></i>
                                    ${item.type}
                                </span>
                                <span class="flex items-center">
                                    <i data-lucide="package" class="w-4 h-4 mr-1"></i>
                                    ${item.assetName}
                                </span>
                            </div>
                        </div>
                        <span class="status-badge ${statusClass}">${item.status}</span>
                    </div>
                `;
                
                listContainer.appendChild(itemEl);
            });
            
            lucide.createIcons();
        }

        // Maintenance Modal Functions
        function openScheduleMaintenanceModal() {
            document.getElementById('schedule-maintenance-modal').classList.add('show');
            
            // Populate asset dropdown
            const assets = db.getAssets();
            const assetSelect = document.getElementById('maintenance-asset');
            assetSelect.innerHTML = '<option value="">Select Asset</option>';
            
            assets.forEach(asset => {
                const option = document.createElement('option');
                option.value = asset.id;
                option.textContent = `${asset.name} (${asset.id})`;
                assetSelect.appendChild(option);
            });
            
            // Set default date to today
            document.getElementById('maintenance-date').valueAsDate = new Date();
        }

        function saveMaintenance(event) {
            event.preventDefault();
            
            const assetId = document.getElementById('maintenance-asset').value;
            const asset = db.getAssets().find(a => a.id === assetId);
            
            const maintenance = {
                title: document.getElementById('maintenance-title').value,
                assetId: assetId,
                assetName: asset ? asset.name : 'Unknown',
                date: document.getElementById('maintenance-date').value,
                time: document.getElementById('maintenance-time').value,
                type: document.getElementById('maintenance-type').value,
                status: 'Scheduled',
                description: document.getElementById('maintenance-description').value
            };
            
            db.saveMaintenance(maintenance);
            closeModal('schedule-maintenance-modal');
            
            if (maintenanceView === 'calendar') {
                generateCalendar();
            } else {
                loadMaintenanceList();
            }
            
            showToast('Maintenance scheduled successfully');
        }

        // Reports Functions
        function generateReport(type) {
            const data = db.exportData();
            
            switch(type) {
                case 'inventory':
                    generateInventoryReport(data.assets);
                    break;
                case 'depreciation':
                    generateDepreciationReport(data.assets);
                    break;
                case 'maintenance':
                    generateMaintenanceReport(data.maintenance);
                    break;
            }
            
            showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} report generated`);
        }

        function generateInventoryReport(assets) {
            let html = `
                <html>
                <head>
                    <title>Asset Inventory Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        h1 { color: #333; }
                    </style>
                </head>
                <body>
                    <h1>Asset Inventory Report</h1>
                    <p>Generated on: ${new Date().toLocaleString()}</p>
                    <p>Total Assets: ${assets.length}</p>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Location</th>
                                <th>Value</th>
                                <th>Purchase Date</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            assets.forEach(asset => {
                html += `
                    <tr>
                        <td>${asset.id}</td>
                        <td>${asset.name}</td>
                        <td>${asset.category}</td>
                        <td>${asset.status}</td>
                        <td>${asset.location}</td>
                        <td>Rp ${asset.value.toLocaleString('id-ID')}</td>
                        <td>${formatDate(asset.purchaseDate)}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'asset-inventory-report.html';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function generateDepreciationReport(assets) {
            // Simple depreciation calculation (5% per year)
            const report = assets.map(asset => {
                const purchaseDate = new Date(asset.purchaseDate);
                const yearsOld = (new Date() - purchaseDate) / (365.25 * 24 * 60 * 60 * 1000);
                const depreciationRate = 0.05; // 5% per year
                const currentValue = asset.value * Math.pow(1 - depreciationRate, yearsOld);
                
                return {
                    ...asset,
                    yearsOld: Math.round(yearsOld * 10) / 10,
                    currentValue: Math.round(currentValue),
                    totalDepreciation: asset.value - Math.round(currentValue)
                };
            });
            
            let html = `
                <html>
                <head>
                    <title>Asset Depreciation Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        h1 { color: #333; }
                    </style>
                </head>
                <body>
                    <h1>Asset Depreciation Report</h1>
                    <p>Generated on: ${new Date().toLocaleString()}</p>
                    <p>Depreciation Rate: 5% per year</p>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Asset Name</th>
                                <th>Purchase Value</th>
                                <th>Current Value</th>
                                <th>Total Depreciation</th>
                                <th>Years Old</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            report.forEach(asset => {
                html += `
                    <tr>
                        <td>${asset.name}</td>
                        <td>Rp ${asset.value.toLocaleString('id-ID')}</td>
                        <td>Rp ${asset.currentValue.toLocaleString('id-ID')}</td>
                        <td>Rp ${asset.totalDepreciation.toLocaleString('id-ID')}</td>
                        <td>${asset.yearsOld} years</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'asset-depreciation-report.html';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function generateMaintenanceReport(maintenance) {
            let html = `
                <html>
                <head>
                    <title>Maintenance Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        h1 { color: #333; }
                    </style>
                </head>
                <body>
                    <h1>Maintenance Report</h1>
                    <p>Generated on: ${new Date().toLocaleString()}</p>
                    <p>Total Maintenance Records: ${maintenance.length}</p>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Asset</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Type</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            maintenance.forEach(item => {
                html += `
                    <tr>
                        <td>${item.title}</td>
                        <td>${item.assetName}</td>
                        <td>${formatDate(item.date)}</td>
                        <td>${item.time}</td>
                        <td>${item.type}</td>
                        <td>${item.status}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'maintenance-report.html';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Settings Functions
        function setSettingsTab(tab) {
            currentSettingsTab = tab;
            
            // Update tabs
            document.querySelectorAll('.settings-tab').forEach(tabBtn => {
                tabBtn.classList.remove('border-indigo-500', 'text-indigo-600');
                tabBtn.classList.add('border-transparent', 'text-gray-500');
            });
            
            event.target.classList.remove('border-transparent', 'text-gray-500');
            event.target.classList.add('border-indigo-500', 'text-indigo-600');
            
            // Show content
            document.querySelectorAll('.settings-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(tab + '-settings').classList.remove('hidden');
        }

        function loadSettings() {
            const settings = db.getSettings();
            
            // Load general settings
            document.getElementById('company-name').value = settings.companyName || '';
            document.getElementById('default-currency').value = settings.defaultCurrency || 'IDR';
            document.getElementById('date-format').value = settings.dateFormat || 'DD/MM/YYYY';
            
            // Load notification settings
            document.getElementById('notify-maintenance').checked = settings.notifyMaintenance !== false;
            document.getElementById('notify-warranty').checked = settings.notifyWarranty !== false;
            document.getElementById('notify-sms').checked = settings.notifySms === true;
            
            // Load security settings
            document.getElementById('session-timeout').value = settings.sessionTimeout || 30;
            document.getElementById('require-2fa').checked = settings.require2FA !== false;
            
            // Load backup settings
            document.getElementById('backup-frequency').value = settings.backupFrequency || 'weekly';
            
            // Load API settings
            document.getElementById('api-key').value = settings.apiKey || 'sk-1234567890abcdef';
        }

        function saveSettings() {
            const settings = db.getSettings();
            
            // Update settings based on current tab
            if (currentSettingsTab === 'general') {
                settings.companyName = document.getElementById('company-name').value;
                settings.defaultCurrency = document.getElementById('default-currency').value;
                settings.dateFormat = document.getElementById('date-format').value;
            } else if (currentSettingsTab === 'notifications') {
                settings.notifyMaintenance = document.getElementById('notify-maintenance').checked;
                settings.notifyWarranty = document.getElementById('notify-warranty').checked;
                settings.notifySms = document.getElementById('notify-sms').checked;
            } else if (currentSettingsTab === 'security') {
                settings.sessionTimeout = parseInt(document.getElementById('session-timeout').value);
                settings.require2FA = document.getElementById('require-2fa').checked;
            } else if (currentSettingsTab === 'backup') {
                settings.backupFrequency = document.getElementById('backup-frequency').value;
            } else if (currentSettingsTab === 'api') {
                settings.apiKey = document.getElementById('api-key').value;
            }
            
            db.saveSettings(settings);
            showToast('Settings saved successfully');
        }

        function backupData() {
            const data = db.exportData();
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `asset-management-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showToast('Data backed up successfully');
        }

        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            db.importData(data);
                            showToast('Data restored successfully');
                            
                            // Refresh current page
                            if (currentPage === 'dashboard') updateDashboard();
                            else if (currentPage === 'assets') loadAssets();
                            else if (currentPage === 'users') loadUsers();
                            
                        } catch (error) {
                            showToast('Error: Invalid backup file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }

        function toggleApiKeyVisibility() {
            const input = document.getElementById('api-key');
            const button = event.target;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'Hide';
            } else {
                input.type = 'password';
                button.textContent = 'Show';
            }
        }

        function generateApiKey() {
            const newKey = 'sk-' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            document.getElementById('api-key').value = newKey;
            showToast('New API key generated');
        }

        // Chart Functions
        function initDashboardCharts() {
            const assets = db.getAssets();
            const maintenance = db.getMaintenance();
            
            // Asset Distribution Chart
            const assetCtx = document.getElementById('assetChart');
            if (assetCtx) {
                if (assetCtx.chart) {
                    assetCtx.chart.destroy();
                }
                
                const categoryCounts = {};
                assets.forEach(asset => {
                    categoryCounts[asset.category] = (categoryCounts[asset.category] || 0) + 1;
                });
                
                assetCtx.chart = new Chart(assetCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(categoryCounts),
                        datasets: [{
                            data: Object.values(categoryCounts),
                            backgroundColor: [
                                '#6366f1',
                                '#8b5cf6',
                                '#ec4899',
                                '#f59e0b'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Maintenance Overview Chart
            const maintenanceCtx = document.getElementById('maintenanceChart');
            if (maintenanceCtx) {
                if (maintenanceCtx.chart) {
                    maintenanceCtx.chart.destroy();
                }
                
                // Generate monthly data
                const monthlyData = {
                    'Jan': { completed: 12, scheduled: 8 },
                    'Feb': { completed: 19, scheduled: 12 },
                    'Mar': { completed: 8, scheduled: 15 },
                    'Apr': { completed: 15, scheduled: 10 },
                    'May': { completed: 22, scheduled: 18 },
                    'Jun': { completed: 18, scheduled: 14 }
                };
                
                maintenanceCtx.chart = new Chart(maintenanceCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(monthlyData),
                        datasets: [{
                            label: 'Completed',
                            data: Object.values(monthlyData).map(d => d.completed),
                            backgroundColor: '#10b981'
                        }, {
                            label: 'Scheduled',
                            data: Object.values(monthlyData).map(d => d.scheduled),
                            backgroundColor: '#f59e0b'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }

        function initReportsCharts() {
            const assets = db.getAssets();
            
            // Asset Value Chart
            const valueCtx = document.getElementById('valueChart');
            if (valueCtx) {
                if (valueCtx.chart) {
                    valueCtx.chart.destroy();
                }
                
                const categoryValues = {};
                assets.forEach(asset => {
                    categoryValues[asset.category] = (categoryValues[asset.category] || 0) + asset.value;
                });
                
                valueCtx.chart = new Chart(valueCtx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(categoryValues),
                        datasets: [{
                            data: Object.values(categoryValues),
                            backgroundColor: [
                                '#6366f1',
                                '#8b5cf6',
                                '#ec4899',
                                '#f59e0b'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Cost Chart
            const costCtx = document.getElementById('costChart');
            if (costCtx) {
                if (costCtx.chart) {
                    costCtx.chart.destroy();
                }
                
                costCtx.chart = new Chart(costCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Maintenance Costs',
                            data: [2400000, 1800000, 3200000, 2100000, 2800000, 1900000],
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'Rp ' + value.toLocaleString('id-ID');
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // Utility Functions
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark');
            
            // Update charts for dark mode
            if (currentPage === 'dashboard') {
                updateDashboardChartsTheme();
            }
        }

        function updateDashboardChartsTheme() {
            // Update chart colors for dark mode
            const textColor = isDarkMode ? '#ffffff' : '#374151';
            const gridColor = isDarkMode ? '#374151' : '#e5e7eb';
            
            [document.getElementById('assetChart'), document.getElementById('maintenanceChart')].forEach(ctx => {
                if (ctx && ctx.chart) {
                    ctx.chart.options.plugins.legend.labels.color = textColor;
                    if (ctx.chart.options.scales) {
                        Object.values(ctx.chart.options.scales).forEach(scale => {
                            scale.ticks.color = textColor;
                            scale.grid.color = gridColor;
                        });
                    }
                    ctx.chart.update();
                }
            });
        }

        function toggleNotifications() {
            const panel = document.getElementById('notification-panel');
            panel.classList.toggle('hidden');
            
            if (!panel.classList.contains('hidden')) {
                loadNotifications();
            }
        }

        function loadNotifications() {
            const activities = db.getActivities().slice(0, 10);
            const notificationList = document.getElementById('notification-list');
            notificationList.innerHTML = '';
            
            if (activities.length === 0) {
                notificationList.innerHTML = '<div class="p-4 text-center text-gray-500">No notifications</div>';
                return;
            }
            
            activities.forEach(activity => {
                const notificationEl = document.createElement('div');
                notificationEl.className = 'p-4 hover:bg-gray-50 border-b border-gray-100';
                
                const iconClass = getActivityIcon(activity.type);
                const iconColor = getActivityColor(activity.type);
                const timeAgo = getTimeAgo(new Date(activity.timestamp));
                
                notificationEl.innerHTML = `
                    <div class="flex items-start">
                        <div class="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3"></div>
                        <div>
                            <p class="text-sm font-medium">${activity.description}</p>
                            <p class="text-xs text-gray-500">${timeAgo}</p>
                        </div>
                    </div>
                `;
                
                notificationList.appendChild(notificationEl);
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.style.background = type === 'error' ? '#ef4444' : '#10b981';
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
            
            const panel = document.getElementById('notification-panel');
            const button = event.target.closest('button[onclick="toggleNotifications()"]');
            
            if (!panel.contains(event.target) && !button) {
                panel.classList.add('hidden');
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            initDashboardCharts();
            lucide.createIcons();
        });
    </script>
</body>
</html>
